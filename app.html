<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>O Mascote — Painel</title>

<style>
:root{
--bg0:#070a12;
--bg1:#0b1020;
--txt:#ffffff;
--accent1:#2f5bff;
--accent2:#1730a8;
--shadow:0 20px 60px rgba(0,0,0,.45);
--shadow2:0 10px 28px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
body{
font-family:system-ui;
color:var(--txt);
margin:0;
min-height:100vh;
padding:20px;
background:linear-gradient(180deg,var(--bg0),var(--bg1));
}
.wrap{max-width:520px;margin:auto}
button{padding:10px 14px;border:0;border-radius:999px;color:#fff;font-weight:700;cursor:pointer}
.btnBlue{background:linear-gradient(135deg,var(--accent1),var(--accent2))}
.btnRed{background:linear-gradient(135deg,#ff4f4f,#c22d2d)}
.btnGreen{background:linear-gradient(135deg,#2ecc71,#1b9b51);border-radius:16px;padding:14px}
.panel{background:rgba(255,255,255,.05);border-radius:20px;padding:16px;box-shadow:var(--shadow)}
.card{margin-top:12px;background:rgba(0,0,0,.25);padding:14px;border-radius:16px}
.meta{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
.pill{background:rgba(0,0,0,.3);padding:6px 12px;border-radius:999px;font-size:12px}
.formGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.full{grid-column:1/-1}
label{font-size:12px;display:block;margin-bottom:6px}
input{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.1);background:rgba(0,0,0,.25);color:#fff}
.submitRow{display:flex;justify-content:center;margin-top:6px}
</style>
</head>

<body>
<div class="wrap">

<div style="display:flex;justify-content:space-between;margin-bottom:12px">
<div style="font-weight:800">O Mascote</div>
<div>
<button class="btnBlue" id="btnAtualizar">Atualizar</button>
<button class="btnRed" id="btnSair">Sair</button>
</div>
</div>

<div class="panel">

<h1 id="welcome" style="text-align:center">Seu time</h1>

<div class="card">
<div class="meta">
<div class="pill" id="plano">Plano: —</div>
<div class="pill" id="usados">Usados no mês: —</div>
<div class="pill" id="status">Status: —</div>
</div>

<h2 style="text-align:center">Criar pedido</h2>

<form id="pedidoForm" class="formGrid" enctype="multipart/form-data">

<div>
<label>Rodada / Fase *</label>
<input id="rodada" required />
</div>

<div>
<label>Data do jogo *</label>
<input id="dataJogo" required />
</div>

<div>
<label>Horário *</label>
<input id="hora" required />
</div>

<div>
<label>Arena / Local *</label>
<input id="arena" required />
</div>

<div class="full">
<label>Mascote (opcional)</label>
<input id="mascote" type="file" />
</div>

<div>
<label>Escudo 1 *</label>
<input id="escudo1" type="file" required />
</div>

<div>
<label>Escudo 2 *</label>
<input id="escudo2" type="file" required />
</div>

<div class="full">
<label>Imagens de patrocinadores (opcional)</label>
<input id="patrocinadores" type="file" multiple />
</div>

<div class="full submitRow">
<button class="btnGreen" type="submit">Criar pedido</button>
</div>

<div class="full" id="msgPedido"></div>

</form>
</div>
</div>
</div>

<script>
const API_BASE="https://api.omascote.com.br";
const token=localStorage.getItem("omascote_token");
if(!token) window.location.href="index.html";

const welcomeEl=document.getElementById("welcome");
const planoEl=document.getElementById("plano");
const usadosEl=document.getElementById("usados");
const statusEl=document.getElementById("status");
const msgPedidoEl=document.getElementById("msgPedido");

function applyLocal(){
const nome=localStorage.getItem("omascote_nome_time")||"";
const plano=localStorage.getItem("omascote_plano")||"";
const usados=localStorage.getItem("omascote_usados")||"";
welcomeEl.textContent=nome||"Seu time";
planoEl.textContent=`Plano: ${plano||"—"} pedidos/mês`;
usadosEl.textContent=`Usados no mês: ${usados||"—"}`;
}

async function refreshMe(){
try{
const r=await fetch(`${API_BASE}/me`,{
headers:{Authorization:"Bearer "+token}
});
const data=await r.json();
if(data.ok){
localStorage.setItem("omascote_nome_time",data.nome_time||"");
localStorage.setItem("omascote_plano",data.plano||"");
localStorage.setItem("omascote_usados",data.usados_no_ciclo||"");
applyLocal();
statusEl.textContent=data.ativo?"Status: ativo":"Status: inativo";
}
}catch{}
}

document.getElementById("pedidoForm").addEventListener("submit",async(e)=>{
e.preventDefault();
msgPedidoEl.textContent="Enviando...";

const fd=new FormData();
fd.append("rodada",document.getElementById("rodada").value);
fd.append("data",document.getElementById("dataJogo").value);
fd.append("hora",document.getElementById("hora").value);
fd.append("arena",document.getElementById("arena").value);

const mascoteFile=document.getElementById("mascote").files[0];
if(mascoteFile) fd.append("mascote",mascoteFile);

fd.append("escudo1",document.getElementById("escudo1").files[0]);
fd.append("escudo2",document.getElementById("escudo2").files[0]);

const pats=document.getElementById("patrocinadores").files;
for(const file of pats){fd.append("patrocinadores",file);}

try{
const r=await fetch(`${API_BASE}/pedidos`,{
method:"POST",
headers:{Authorization:"Bearer "+token},
body:fd
});
const out=await r.json();
if(out.ok){
msgPedidoEl.textContent=`Pedido enviado! ID: ${out.pedido_id}`;
refreshMe();
}else{
msgPedidoEl.textContent=out.error||"Erro ao enviar";
}
}catch{
msgPedidoEl.textContent="Erro de rede";
}
});

applyLocal();
refreshMe();

document.getElementById("btnSair").addEventListener("click",()=>{
localStorage.removeItem("omascote_token");
window.location.href="index.html";
});

document.getElementById("btnAtualizar").addEventListener("click",refreshMe);
</script>

</body>
</html>
